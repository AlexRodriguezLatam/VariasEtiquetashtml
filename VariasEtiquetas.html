<!DOCTYPE html>
<html>
<head>
  <title>Etiquetas por AWB</title>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <style>
    @page {
      size: A6 landscape;
      margin: 0;
    }

    body {
      font-family: 'Trebuchet MS', 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }

    .contenedor-etiqueta {
      width: 148mm;
      height: 105mm;
      box-sizing: border-box;
      padding: 5mm;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid black;
      page-break-after: always;
    }

    .logo-empresa {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5mm;
      text-align: center;
      width: 100%;
    }

    .section-box {
      width: calc(100% - 2mm);
      margin-bottom: 5mm;
      padding: 3mm;
      text-align: center;
    }

    .barcode-text {
      font-weight: bold;
      word-break: break-word;
      padding-bottom: 2mm;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }

    .data-table th, .data-table td {
      border: 1px solid black;
      padding: 4mm 2mm;
      text-align: center;
    }

    .data-table th {
      background-color: #858585;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="contenedor-etiquetas"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const id_awb = params.get('id_awb');

      // Simulación de datos LABEL (puedes reemplazar esto con fetch desde JSON o Google Sheets)
      const etiquetas = [
        {
          awb: "123456",
          sku: "ABC-001",
          pcs: "10",
          destino: "Bogotá",
          skid: "SK01",
          ref: "ABC001",
          empresa: "E-CARGO TOLEDO"
        },
        {
          awb: "123456",
          sku: "ABC-002",
          pcs: "5",
          destino: "Medellín",
          skid: "SK02",
          ref: "ABC002",
          empresa: "E-CARGO TOLEDO"
        }
      ];

      const contenedor = document.getElementById('contenedor-etiquetas');

      etiquetas
        .filter(e => e.awb === id_awb)
        .forEach((etiqueta, index) => {
          const div = document.createElement('div');
          div.className = 'contenedor-etiqueta';
          div.innerHTML = `
            <div class="logo-empresa">${etiqueta.empresa}</div>
            <div class="section-box">
              <div id="barcode-container-${index}">
                <svg id="barcode-${index}"></svg>
              </div>
              <div class="barcode-text">${etiqueta.sku}</div>
            </div>
            <div class="section-box">
              <table class="data-table">
                <thead>
                  <tr><th>PCS</th><th>DESTINO</th><th>SKID</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <td>${etiqueta.pcs}</td>
                    <td>${etiqueta.destino}</td>
                    <td>${etiqueta.skid}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          contenedor.appendChild(div);

          JsBarcode(`#barcode-${index}`, etiqueta.sku, {
            format: "CODE128",
            displayValue: false,
            height: 80,
            width: 1.5,
            margin: 0,
          });
        });

      setTimeout(() => {
        window.print();
      }, 1000);
    });
  </script>
</body>
</html>
